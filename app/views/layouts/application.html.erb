<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D7RCWZ50GD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-D7RCWZ50GD');
    </script>

    <title><%= content_for(:title) ? "#{content_for(:title)}" + " | Machi Vigil" : "Machi Vigil" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- OGP 基本設定 -->
    <meta property="og:title" content="<%= content_for?(:og_title) ? yield(:og_title) : 'Machi Vigil' %>" />
    <meta property="og:description" content="<%= content_for?(:og_description) ? yield(:og_description) : 'まちの安全をみんなで見守ろう' %>" />
    <meta property="og:image" content="<%= content_for?(:og_image) ? yield(:og_image) : image_url('Machi_Vigil_OGP.png') %>" />
    <meta property="og:url" content="<%= request.original_url %>" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Machi Vigil" />

    <!-- Twitterカード対応（任意） -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="<%= content_for?(:og_title) ? yield(:og_title) : 'Machi Vigil' %>" />
    <meta name="twitter:description" content="<%= content_for?(:og_description) ? yield(:og_description) : 'まちの安全をみんなで見守ろう' %>" />
    <meta name="twitter:image" content="<%= content_for?(:og_image) ? yield(:og_image) : image_url('Machi_Vigil_OGP.png') %>" />

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
  </head>

  <body class="flex flex-col min-h-[100vh] <%= content_for?(:body_class) ? yield(:body_class) : "bg-[#E6F0FE]" %>"
    data-controller="loading"
  >
    <%# ローディングアニメーション %>
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-transparent"
      data-loading-target="overlay"
    >
      <div class="animate-spin rounded-full h-10 w-10 border-orange-500 border-4 border-t-transparent"></div>
    </div>

    <% unless controller.controller_name == "tops" %>
      <%= render "shared/header"%>
    <% end %>

    <%# フラッシュメッセージ %>
    <div
      id="flash_messages"
      data-controller="flash"
      data-action="machi-repos--form:flash-alert@window->flash#showAlertMessage machi-repos--form:flash-clear@window->flash#clear
      machi-repos--chat:flash-alert@window->flash#showAlertMessage
      machi-repos--chat:flash-clear@window->flash#clear"
    >
      <%= render "shared/flash_messages" %>
    </div>

    <main class="flex-1 pb-15 md:pb-0">
      <%= yield %>
    </main>

    <%= render "shared/footer"%>

    <div class="md:hidden">
      <%= render "shared/navigation" %>
    </div>

    <%= render "shared/top_button" %>
  </body>
</html>
