<%# info_levelに応じてbody背景色変更 %>
<% content_for :body_class, "bg-#{@machi_repo.info_level}" %>

<div class="border-b-3 border-gray-500">
  <div class="text-center">
    <div class="mx-auto py-4 px-2 max-w-[550px]">
      <div class="flex justify-between items-center mx-auto mb-4">
        <div class="flex items-center <%= "text-#{@machi_repo.info_level}" %>">
          <%# info_levelに応じてアイコン変更 %>
          <div class="w-10 aspect-square">
            <% if @machi_repo.emergency? %>
              <%= render "shared/icons/emergency_full_icon" %>
              <% info_level_text = "緊急" %>
            <% elsif @machi_repo.warn? %>
              <%= render "shared/icons/warn_full_icon" %>
              <% info_level_text = "警告" %>
            <% else %>
              <%= render "shared/icons/share_full_icon" %>
              <% info_level_text = "共有" %>
            <% end %>
          </div>
          <span class="text-xl font-bold"><%= info_level_text %></span>
        </div>
        <% if @machi_repo.user != current_user %>
          <div class="w-10 aspect-square">
            <%= render "shared/icons/star_icon" %>
          </div>
        <% end %>
      </div>
      <div class="mx-auto w-[90%] md:w-full">
        <h2 class="inline-block px-4 py-2 min-w-[50%] <%= "title-bg-#{@machi_repo.info_level}" %> text-white text-xl font-bold rounded shadow">
          <%= @machi_repo.title %>
        </h2>
      </div>
    </div>
    <nav class="md:fixed md:top-[250px] md:right-[calc(100vw/2+280px)] xl:right-[calc(100vw/2+460px)]">
      <ul class="flex justify-center gap-12 mb-4 md:flex-col">
        <!-- 詳細アイコン -->
        <li>
          <div class="icon-circle-wrapper">
            <div class="icon-circle icon-circle-current">
              <div class="w-8 aspect-square">
                <%= render "shared/icons/description_icon" %>
              </div>
            </div>
            <span class="icon-circle-text">詳細</span>
          </div>
        </li>
        <!-- チャットアイコン -->
        <li>
          <div class="icon-circle-wrapper">
            <div class="icon-circle">
              <div class="w-8 aspect-square">
                <%= render "shared/icons/chat_icon" %>
              </div>
            </div>
            <span class="icon-circle-text">チャット</span>
          </div>
        </li>
      </ul>
    </nav>
  </div>
</div>

<section class="mx-auto pt-4 pb-8 max-w-120 xl:max-w-205">
  <%# 編集・削除 %>
  <% if @machi_repo.user == current_user %>
    <div class="flex justify-end gap-2 mb-4 pr-2 w-full">
      <%# 編集 %>
      <%= link_to "#", class: "inline-block border-2 rounded px-2 bg-green-100 text-green-700 shadow" do %>
        <div class="flex flex-col justify-center items-center">
          <div class="w-8 aspect-square">
            <%= render "shared/icons/edit_note_icon" %>
          </div>
          <span class="text-sm">編集</span>
        </div>
      <% end %>
      <%# 削除 %>
      <%= link_to "#", class: "inline-block border-2 rounded px-2 bg-red-100 text-red-700 shadow" do %>
        <div class="flex flex-col justify-center items-center">
          <div class="w-8 aspect-square">
            <%= render "shared/icons/delete_icon" %>
          </div>
          <span class="text-sm">削除</span>
        </div>
      <% end %>
    </div>
  <% end %>
  <div class="xl:flex xl:justify-between xl:mx-auto">
    <div class="xl:w-100">
      <!-- 投稿者 -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">投稿者</span>
        </h3>
        <div class="flex items-center ml-4">
          <div class="w-8 aspect-square">
            <%= render "shared/icons/face_icon" %>
          </div>
          <div class="ml-1 text-xl font-bold">
            <%= @machi_repo.user.profile.nickname %>
          </div>
        </div>
      </div>
      <!-- カテゴリー -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">カテゴリー</span>
        </h3>
        <div class="flex items-center ml-4">
          <div class="text-2xl">
            <%= display_machi_repo_category_emoji(@machi_repo.category) %>
          </div>
          <div class="ml-1 text-xl font-bold">
            <%= MachiRepo.categories_i18n[@machi_repo.category] %>
          </div>
        </div>
      </div>
      <!-- タグ -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">タグ</span>
        </h3>
        <div class="flex items-center ml-4">
          <% if @machi_repo.tag_names.present? %>
            <div class="flex flex-wrap gap-2 p-2 pt-1">
              <% @machi_repo.tag_names.split(',').each do |tag| %>
                <div class="tag">
                  <span class="tag-text"><%= "#" + tag %></span>
                </div>
              <% end %>
            </div>
          <% else %>
            <span class="ml-1 text-xl">（タグなし）</span>
          <% end %>
        </div>
      </div>
      <!-- 投稿日時 -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">投稿日時</span>
        </h3>
        <div class="flex items-center ml-4">
          <div class="w-8 aspect-square">
            <%= render "shared/icons/schedule_icon" %>
          </div>
          <div class="ml-1 text-xl font-bold">
            <%= @machi_repo.created_at.strftime("%Y/%m/%d %H:%M") %>
          </div>
        </div>
      </div>
      <!-- 状況説明 -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">状況説明</span>
        </h3>
        <div class="flex items-center ml-4">
          <div class="ml-1 text-xl leading-normal tracking-wider">
            <% if @machi_repo.description.present? %>
              <%= simple_format(@machi_repo.description) %>
            <% else %>
              <p>（未記入）</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="xl:w-100">
      <!-- ホットスポット -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">ホットスポット</span>
        </h3>
        <!-- 住所 -->
        <div class="my-4 text-center">
          <div class="inline-block px-2 border-b-2 border-[#DF3737] text-2xl">
            <div class="flex items-center">
              <div class="inline-block w-6 aspect-square text-[#DF3737]">
                <%= render "shared/icons/flag_full_icon" %>
              </div>
              <span class="text-xl font-bold">
                <%= @machi_repo.address %>
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- Google Map -->
      <div
        data-controller="machi-repos--show"
        data-machi-repos--show-api-key-value="<%= ENV["GOOGLE_MAPS_API_KEY_CLIENT"] %>"
        data-machi-repos--show-map-id-value="<%= ENV["GOOGLE_MAPS_MAP_ID"] %>"
        data-machi-repos--show-machi-repo-value="<%= @machi_repo.to_json(include: { user: { include: :profile } }) %>"
        id="map-wrapper"
        class="mx-auto w-full max-w-[500px] md:max-w-175 xl:max-w-300"
      >
        <div id="map" data-machi-repos--show-target="map" class="mb-4 mx-auto w-full max-w-[400px] aspect-square"></div>
      </div>

      <!-- 画像 -->
      <div class="mb-4 px-2">
        <h3 class="mb-2">
          <span class="header2 <%= "border-color-#{@machi_repo.info_level}" %>">画像</span>
        </h3>
        <div class="ml-4 w-[90%]">
          <% if @machi_repo.image? %>
            <%= image_tag(@machi_repo.image.url, class: "object-cover") %>
          <% else %>
            <span class="ml-1 text-xl">（画像なし）</span>
          <% end %>
        </div>
      </div>
  </div>
  </div>
</section>
